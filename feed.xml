<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Xudong's Blog</title>
    <description>人工智障，机器算命</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Wed, 24 Apr 2019 22:05:06 +0800</pubDate>
    <lastBuildDate>Wed, 24 Apr 2019 22:05:06 +0800</lastBuildDate>
    <generator>Jekyll v3.7.4</generator>
    
      <item>
        <title>docker入门</title>
        <description>&lt;h1 id=&quot;一docker简介&quot;&gt;一、Docker简介&lt;/h1&gt;
&lt;p&gt;深度学习甚至其他机器学习算法对于系统的环境是苛刻的，往往我们需要花大量的时间去完成一套算法的配置。但是当我们想切换另一套代码时，会发现它所要求的运行环境与前一套大相径庭。如果我们重新安装系统从头开始配置新的环境，那之前配置的那套环境又前功尽弃了。&lt;/p&gt;

&lt;p&gt;所以我们本能的想到：是不是有一种方法，让多种系统环境存在于一台PC上呢？也许虚拟机是你第一种想到的方法。&lt;/p&gt;

&lt;p&gt;一个系统装多个版本的虚拟机，不同虚拟机内配置不同的运行环境，是不是就能解决了这个问题？&lt;/p&gt;

&lt;p&gt;虚拟机只能部分解决这类问题。用过虚拟机的同学可能会发现以下问题：觉得系统跑虚拟机时特别费劲，用笔记本的同学会发现本子发烫，虚拟机内应用反应慢一拍等等。另外更重要的一点就是，用&lt;strong&gt;虚拟机&lt;/strong&gt;跑深度学习，对于&lt;strong&gt;显卡的兼容性极差&lt;/strong&gt;，基本可以放弃使用虚拟机装CUDA了。&lt;/p&gt;

&lt;p&gt;说到这里我们就要隆重介绍下容器——Docker。刚上手我们可以把他看做是&lt;strong&gt;“没有操作系统的虚拟机”&lt;/strong&gt;，也就是说容器可以与宿主机共享一个操作系统，共享CPU、RAM以及硬盘等。但是容器拥有独立的系统环境，因此可以保证部署独立的应用而不受宿主机的配置环境的影响。此外在一台机器上配置多个环境，在多种环境之间切换不同功能的算法，这在做研究时可以当做是一种杀手锏。
&lt;img src=&quot;/img/in-post/docker/fig1.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;本文就从安装和配置开始教大家如何使用docker和用它怎么搭建深度学习算法运行环境，最后实现用docker搭建深度学习的推荐系统Neural Factorization Machine.&lt;/p&gt;

&lt;h1 id=&quot;二本机docker宿主机系统环境&quot;&gt;二、本机（docker宿主机）系统环境&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;（1）64位 ubuntu16.04&lt;/strong&gt;
&lt;strong&gt;（2）独立NVIDIA显卡&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;同学们要注意哦，由于有些笔记本包含独立显卡和集成显卡，里面涉及到禁用集成显卡的问题，比较复杂。这里我们就用台式机的独立显卡来作为硬件环境进行研究。&lt;/p&gt;

&lt;h1 id=&quot;三安装docker和nvidia-docker&quot;&gt;三、安装docker和nvidia-docker&lt;/h1&gt;
&lt;p&gt;使用docker来配置深度学习环境的容器需要安装英伟达的插件，因为普通的docker容器里是没有显卡驱动的。而官方的docker安装指南和nvidia插件安装指南可以参考以下两个链接。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;docker:&lt;/em&gt;
&lt;a href=&quot;https://docs.docker.com/install/linux/docker-ce/ubuntu/#prerequisites&quot;&gt;https://docs.docker.com/install/linux/docker-ce/ubuntu/#prerequisites&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;nvidia-docker:&lt;/em&gt;
&lt;a href=&quot;https://devblogs.nvidia.com/nvidia-docker-gpu-server-application-deployment-made-easy/&quot;&gt;https://devblogs.nvidia.com/nvidia-docker-gpu-server-application-deployment-made-easy/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;不想看官方文档的同学可以看本节总结的以下几个步骤。当然在宿主机安装docker之前需要确认自己的电脑已经拥有nvidia显卡的完整驱动，用&lt;code class=&quot;highlighter-rouge&quot;&gt;nvidia-smi&lt;/code&gt;这句命令来验证是否安装完整nvidia驱动。&lt;/p&gt;

&lt;h2 id=&quot;1如果本机之前安装过docker需要卸载旧docker&quot;&gt;（1）如果本机之前安装过docker，需要卸载旧docker：&lt;/h2&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get remove docker docker-engine docker.io containerd runc
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;2安装docker-ce-社区版本community-edition的docker&quot;&gt;（2）安装Docker CE 社区版本（Community Edition）的docker&lt;/h2&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install apt-transport-https ca-certificates curl gnupg-agent  software-properties-common
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-fsSL&lt;/span&gt; https://download.docker.com/linux/ubuntu/gpg | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-key add -
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-key fingerprint 0EBFCD88
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;add-apt-repository &lt;span class=&quot;s2&quot;&gt;&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;lsb_release &lt;span class=&quot;nt&quot;&gt;-cs&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; stable&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install docker-ce docker-ce-cli containerd.io
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;完成安装docker，然后可以在终端输入&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker run hello-world
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;来检验安装，如果出现以下界面，则说明docker安装成功。
&lt;img src=&quot;/img/in-post/docker/fig2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;3安装nvidia-docker的插件&quot;&gt;（3）安装nvidia-docker的插件&lt;/h2&gt;
&lt;p&gt;如果系统之前安装过nvidia-docker插件的话，需要清除下：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker volume &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nvidia-docker | xargs &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n1&lt;/span&gt; docker ps &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;volume&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={}&lt;/span&gt; | xargs &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; docker rm &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get purge &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; nvidia-docker
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;没有装过的话，我们正式开始安装nvidia插件&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;# Add the package repositories&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; https://nvidia.github.io/nvidia-docker/gpgkey |   &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-key add -
&lt;span class=&quot;nv&quot;&gt;$ distribution&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; /etc/os-release&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ID$VERSION_ID&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; https://nvidia.github.io/nvidia-docker/&lt;span class=&quot;nv&quot;&gt;$distribution&lt;/span&gt;/nvidia-docker.list | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;tee /etc/apt/sources.list.d/nvidia-docker.list
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update

&lt;span class=&quot;c&quot;&gt;# Install nvidia-docker2 and reload the Docker daemon configuration&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; nvidia-docker2
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;pkill &lt;span class=&quot;nt&quot;&gt;-SIGHUP&lt;/span&gt; dockerd

&lt;span class=&quot;c&quot;&gt;# Test nvidia-smi with the latest official CUDA image&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker run &lt;span class=&quot;nt&quot;&gt;--runtime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;nvidia &lt;span class=&quot;nt&quot;&gt;--rm&lt;/span&gt; nvidia/cuda:9.0-base nvidia-smi
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;最后出现以下类似内容说明nvidia-docker已经安装成功了。
&lt;img src=&quot;/img/in-post/docker/fig3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;四创建容器下的深度学习运行环境&quot;&gt;四、创建容器下的深度学习运行环境&lt;/h1&gt;
&lt;h2 id=&quot;1-镜像image和容器container&quot;&gt;(1) 镜像Image和容器Container&lt;/h2&gt;
&lt;p&gt;在学习使用docker之前，我们应该知道两个概念：&lt;strong&gt;镜像Image&lt;/strong&gt;和&lt;strong&gt;容器Container&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;镜像image其实通俗的理解为&lt;strong&gt;“系统安装盘”&lt;/strong&gt;，有个安装盘是ubuntu16.04有的安装盘是ubuntu18.04，有的安装盘里已经装好了tensorflow，有的安装盘里本身就有CUDA8.0等等。而容器则可以通俗理解为&lt;strong&gt;“安装好的系统”&lt;/strong&gt;，一个系统盘可以装好几个系统，一台电脑上也可以装好几个不同的系统，正如下图所示。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/docker/fig4.png&quot; alt=&quot;&quot; width=&quot;400px&quot; height=&quot;230px&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;2-拉取镜像&quot;&gt;(2) 拉取镜像&lt;/h2&gt;
&lt;p&gt;首先我们可以使用&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo docker images&lt;/code&gt;来查看自己已经安装了哪些镜像，如下图所示。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/docker/fig5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到我除了之前验证docker安装时拉取的hello-world和nvidia/cuda:9.0外，还拉取了其他的一些镜像。例如其中的tensorflow/tensorflow:1.12.0-devel-gpu系统镜像，我们就可以通过&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo docker image pull tensorflow/tensorflow:1.12.0-devel-gpu&lt;/code&gt;来下载。&lt;/p&gt;

&lt;p&gt;那么我们怎么知道有哪些镜像可以挑选呢？这里就必须介绍docker hub官网了&lt;a href=&quot;https://hub.docker.com/&quot;&gt;https://hub.docker.com/&lt;/a&gt; ，在这里我们可以选我们想要的哪些镜像，然后通过命令的方式&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo docker image pull xxxx&lt;/code&gt;来下载。像tensorflow、cuda之类的应用都有官方镜像库，当然我们也可以挑选有些达人自己做的镜像，这么一想docker hub就有点像github了。&lt;/p&gt;

&lt;h2 id=&quot;3-实例化容器&quot;&gt;(3) 实例化容器&lt;/h2&gt;
&lt;p&gt;这里我们就以cuda8.0-cudnn5-devel-ubuntu16.04这个镜像为例子，搭建一套深度学习的开发环境。&lt;/p&gt;

&lt;p&gt;首先我们将这个镜像实例化为容器:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nvidia-docker container run &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test &lt;/span&gt;nvidia/cuda:8.0-cudnn5-devel-ubuntu16.04 /bin/bash
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后我们具体解释下这个命令的每个部分：
&lt;strong&gt;nvidia-&lt;/strong&gt;这个前缀是必须的，是用来调用nvidia插件的。命令中的-it 参数是将容器和宿主机的终端连接起来的指令；–name后面是给这个容器取的名字，这个例子中容器叫做test；最后&lt;code class=&quot;highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt;是打开了容器的终端。运行后的界面如下图所示：
&lt;img src=&quot;/img/in-post/docker/fig6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里我们可以发现，shell的提示符已经发生了变化，如上图的&lt;code class=&quot;highlighter-rouge&quot;&gt;root@b8972adc4506:&lt;/code&gt;，这说明我们现在已经在终端内部了，@后的这串字符串就是这个容器的唯一ID。&lt;/p&gt;

&lt;p&gt;现在我们就可以把这个容器当做是一般的ubuntu环境来用就行了。但是有两点需要注意：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1. 容器始终都是拥有root权限，因此不需要在某些命令前面打&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2. 容器可以看做是没有显示器的主机，没有UI界面，因此无法使用一些需要调用UI的应用，诸如gedit等。（文本输入可用vim代替）&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;4-使用容器配置深度学习算法环境&quot;&gt;(4) 使用容器配置深度学习算法环境&lt;/h2&gt;
&lt;p&gt;在刚才创建的这个容器里还没有安装python和tensorflow，下面几步骤使用pip安装上述两者及其他一些拓展包。&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;apt-get update &lt;span class=&quot;c&quot;&gt;#更新&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;apt-get install python &lt;span class=&quot;c&quot;&gt;#安装python2.7&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;apt-get install python-pip &lt;span class=&quot;c&quot;&gt;#安装pip&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pip install tensorflow-gpu&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;1.2.1 &lt;span class=&quot;c&quot;&gt;#安装gpu版本tensorflow1.2.1&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;apt-get install git &lt;span class=&quot;c&quot;&gt;#安装git&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/theodore-zxd/neural_factorization_machine.git &lt;span class=&quot;c&quot;&gt;#这是一个应用深度学习实现推荐系统的应用&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pip install sklearn &lt;span class=&quot;c&quot;&gt;# 安装其他一些需要的拓展库&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python NeuralFM.py &lt;span class=&quot;nt&quot;&gt;--dataset&lt;/span&gt; frappe &lt;span class=&quot;nt&quot;&gt;--hidden_factor&lt;/span&gt; 64 &lt;span class=&quot;nt&quot;&gt;--layers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;64] &lt;span class=&quot;nt&quot;&gt;--keep_prob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;0.8,0.5] &lt;span class=&quot;nt&quot;&gt;--loss_type&lt;/span&gt; square_loss &lt;span class=&quot;nt&quot;&gt;--activation&lt;/span&gt; relu &lt;span class=&quot;nt&quot;&gt;--pretrain&lt;/span&gt; 0 &lt;span class=&quot;nt&quot;&gt;--optimizer&lt;/span&gt; AdagradOptimizer &lt;span class=&quot;nt&quot;&gt;--lr&lt;/span&gt; 0.05 &lt;span class=&quot;nt&quot;&gt;--batch_norm&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--verbose&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--early_stop&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--epoch&lt;/span&gt; 200 &lt;span class=&quot;c&quot;&gt;#最后运行深度学习推荐系统NFM的示例代码&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;如果运行结果如下图类似，那么恭喜你完成了配置，撒花！
&lt;img src=&quot;/img/in-post/docker/fig7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;五docker常用命令&quot;&gt;五、docker常用命令&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;以下命令如果需要调用显卡，需要在&lt;code class=&quot;highlighter-rouge&quot;&gt;docker&lt;/code&gt;前添加&lt;code class=&quot;highlighter-rouge&quot;&gt;nvidia-&lt;/code&gt;前缀。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker container &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#列出所有正在运行的容器，后面跟上-a可显示所有容器&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker container &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; &amp;lt;container-name or container-id&amp;gt; /bin/bash &lt;span class=&quot;c&quot;&gt;#开启容器的一个shell &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker container stop &amp;lt;container-name or container-id&amp;gt; &lt;span class=&quot;c&quot;&gt;#停止容器&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker start &amp;lt;container-name or container-id&amp;gt; &lt;span class=&quot;c&quot;&gt;#开启容器&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker rm &amp;lt;container-name or container-id&amp;gt; &lt;span class=&quot;c&quot;&gt;#删除容器&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;docker inspect &amp;lt;container-name or container-id&amp;gt; &lt;span class=&quot;c&quot;&gt;#显示容器相关信息&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h1 id=&quot;六总结&quot;&gt;六、总结&lt;/h1&gt;
&lt;p&gt;通过本帖子大家可以学会如何使用docker来配置深度学习的容器，以后可以在自己电脑上配置多个环境，想调哪个调哪个，可以说docker是玩转算法的大杀器。&lt;/p&gt;

&lt;p&gt;本博客之前几篇文章专注于环境的搭建，之后我想跟大家多讨论一些算法的原理和技术细节，请大家拭目以待。&lt;/p&gt;
</description>
        <pubDate>Wed, 24 Apr 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/04/24/docker_deep_learning/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/04/24/docker_deep_learning/</guid>
        
        <category>docker</category>
        
        <category>深度学习</category>
        
        <category>推荐系统</category>
        
        
      </item>
    
      <item>
        <title>深度学习进阶</title>
        <description>&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;本文我们就以linux下的深度学习算法入手，从环境配置开始，感受对抗生成网络GAN的性能效果。CSGM和DCGAN是两种典型的基于GAN设计的作用于图像处理的深度学习算法，按照本文的操作流程，读者就可以完成这两个网络的环境搭建和运行。&lt;/p&gt;

&lt;h2 id=&quot;硬件和系统需求&quot;&gt;硬件和系统需求&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;英伟达显卡，显卡的计算能力 &amp;gt;= 3.0，性能越高越好，查询显卡的计算能力的官方链接：&lt;a href=&quot;https://developer.nvidia.com/cuda-gpus&quot;&gt;https://developer.nvidia.com/cuda-gpus&lt;/a&gt; 。经过本人手动验证GTX 780ti以上的显卡可以确保满足需求。&lt;/li&gt;
  &lt;li&gt;系统为Ubuntu，它是一种基于linux开发的免费开源操作系统。大部分的深度学习算法都以这个系统环境下开发为主，之后的大部分算法介绍和应用也将以这个系统环境下进行详细展开。当前业界最为广泛使用的是&lt;strong&gt;ubuntu 16.04 64位系统&lt;/strong&gt;版本，本文也将在这个版本下进行环境搭建。不熟悉ubuntu系统的同学可以先从安装系统学起，留出1~2天的入门学习时间就可以。
    &lt;h2 id=&quot;环境搭建&quot;&gt;环境搭建&lt;/h2&gt;
    &lt;h3 id=&quot;0-禁用集成显卡&quot;&gt;0. 禁用集成显卡&lt;/h3&gt;
    &lt;p&gt;在开始安装之前需要提醒以下电脑是笔记本的同学，极有可能电脑是双显卡，因此需要将飞英伟达的那块显卡禁用掉才能进行以下操作。当然如果只安装了一块显卡的台式机，可以直接跳过这一步，正式开始安装环境。
Nouveau是Ubuntu自带的第三方开源N卡驱动，安装NVIDIA官方驱动之前需要禁用Nouveau.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;（1）删除所有已经安装的nvidia驱动（如果系统是新装的跳过这个步骤）&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get remove nvidia&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt autoremove
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（2）安装一些依赖库&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shel&quot;&gt;$ sudo apt-get install dkms build-essential linux-headers-generic
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;（3）禁用Nouveau
终端输入&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo gedit /etc/modprobe.d/blacklist.conf&lt;/code&gt;在弹出的文本文件中增加下面几句语句&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;blacklist nouveau
blacklist lbm-nouveau
options nouveau &lt;span class=&quot;nv&quot;&gt;modeset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;nouveau off
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;lbm-nouveau off
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;然后保存并退出。继续输入&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;options nouveau &lt;span class=&quot;nv&quot;&gt;modeset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;tee &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /etc/modprobe.d/nouveau-kms.conf
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;update-initramfs &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;重启&lt;code class=&quot;highlighter-rouge&quot;&gt;$ reboot&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;（4）通过这个命令&lt;code class=&quot;highlighter-rouge&quot;&gt;lsmod | grep nouveau&lt;/code&gt;来确认系统是否已经禁用Nouveau，如果没有任何反馈结果，说明已经禁用成功。&lt;/p&gt;

&lt;h3 id=&quot;1-安装gpu版本的tensorflow&quot;&gt;1. 安装GPU版本的tensorflow&lt;/h3&gt;
&lt;p&gt;ubuntu 16.04 系统自带python 2.7，我们可以通过在终端输入&lt;code class=&quot;highlighter-rouge&quot;&gt;python&lt;/code&gt;来验证，并且查看版本号，退出python则输入&lt;code class=&quot;highlighter-rouge&quot;&gt;exit()&lt;/code&gt;。&lt;/p&gt;

&lt;h4 id=&quot;1安装pip&quot;&gt;（1）安装pip&lt;/h4&gt;
&lt;p&gt;接下来正式安装大名鼎鼎的tensorflow，选用pip安装的方式最为便捷。pip是安装python拓展软件包的一个插件，安装命令如下：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install python-pip python-dev &lt;span class=&quot;c&quot;&gt;#安装pip&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;pip install &lt;span class=&quot;nt&quot;&gt;--upgrade&lt;/span&gt; pip &lt;span class=&quot;c&quot;&gt;#更新pip&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;更换pip源为国内源，我们选用阿里云的源，在 &lt;code class=&quot;highlighter-rouge&quot;&gt;~/.pip/&lt;/code&gt;目录下生成配置文件：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mkdir ~/.pip/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gedit ~/.pip/pip.conf 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;然后在弹出的文档编辑器上输入&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[global]
trusted-host=mirrors.aliyun.com
index-url=https://mirrors.aliyun.com/pypi/simple/
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;再保存，关闭。顺带这里提一句，系统的更新也建议切换至国内的源，如下图所示：
&lt;img src=&quot;/img/in-post/GAN/fig1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;2安装gpu驱动&quot;&gt;（2）安装GPU驱动&lt;/h4&gt;
&lt;p&gt;终端输入&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo apt-get update&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;如下图所示在图形界面中安装显卡驱动：
System Settings →Software &amp;amp; Updates→Additional Drivers→Nvidia Corporation→Apply Changes→重启
&lt;img src=&quot;/img/in-post/GAN/fig2.png&quot; alt=&quot;&quot; /&gt;
 验证安装，终端输入&lt;code class=&quot;highlighter-rouge&quot;&gt;nvidia-settings&lt;/code&gt;，出现以下界面说明安装成功
&lt;img src=&quot;/img/in-post/GAN/fig3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;3安装bazel&quot;&gt;（3）安装bazel&lt;/h4&gt;
&lt;p&gt;bazel是Google推出的用来编译tensorflow开源工具，注意这里我们不按照官方安装教程，因为过高版本的bazel会造成后期的编译问题。首先我们在终端输入以下命令：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;add-apt-repository ppa:webupd8team/java
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install oracle-java8-installer
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;验证完成安装JDK8&lt;code class=&quot;highlighter-rouge&quot;&gt;java -version&lt;/code&gt;会显示所安装的java编译器版本号，接下来安装bazel，首先下载bazel安装文件，链接&lt;a href=&quot;https://github.com/bazelbuild/bazel/releases?after=0.9.0&quot;&gt;https://github.com/bazelbuild/bazel/releases?after=0.9.0&lt;/a&gt; 选择&lt;code class=&quot;highlighter-rouge&quot;&gt;bazel-0.5.4-installer-linux-x86_64.sh&lt;/code&gt;下载安装脚本，然后进入下载目录&lt;code class=&quot;highlighter-rouge&quot;&gt;cd &amp;lt;installpath&amp;gt;&lt;/code&gt;进行安装&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;chmod +x bazel-0.5.4-installer-linux-x86_64.sh
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; ./bazel-0.5.4-installer-linux-x86_64.sh
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;4安装cuda-80&quot;&gt;（4）安装CUDA 8.0&lt;/h4&gt;
&lt;p&gt;这里各位也要注意了，各个软件的版本好一定要对上，并非越高级的版本越有效，有时候会出现一些难以解释的问题，都是由于版本不对导致的。这里我们选择CUDA8.0 GA2版本，下载链接：&lt;a href=&quot;https://developer.nvidia.com/cuda-toolkit-archive&quot;&gt;https://developer.nvidia.com/cuda-toolkit-archive&lt;/a&gt; 按照下图步骤选择，下载deb安装文件。
&lt;img src=&quot;/img/in-post/GAN/fig4.png&quot; alt=&quot;&quot; /&gt;
下载完毕后，用终端进入到存放安装包的目录下&lt;code class=&quot;highlighter-rouge&quot;&gt;cd &amp;lt;installpath&amp;gt;&lt;/code&gt;，然后&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;dpkg &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; cuda-repo-ubuntu1604-8-0-local-ga2_8.0.61-1_amd64.deb
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install cuda
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;5安装cudnn-51&quot;&gt;（5）安装cudnn 5.1&lt;/h4&gt;
&lt;p&gt;安装包下载地址：&lt;a href=&quot;https://developer.nvidia.com/rdp/cudnn-archive&quot;&gt;https://developer.nvidia.com/rdp/cudnn-archive&lt;/a&gt; 如下图选择&lt;code class=&quot;highlighter-rouge&quot;&gt;cuDNN v5.1 Library for Linux&lt;/code&gt;
&lt;img src=&quot;/img/in-post/GAN/fig5.png&quot; alt=&quot;&quot; /&gt;
下载完毕后进入下载的文件目录，解压缩，拷贝，覆盖，更新软链接&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-zxvf&lt;/span&gt; cudnn-8.0-linux-x64-v5.1.tgz
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;cp cuda/include/cudnn.h /usr/local/cuda/include
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;cp cuda/lib64/libcudnn&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; /usr/local/cuda/lib64
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/local/cuda/lib64/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rm &lt;span class=&quot;nt&quot;&gt;-rf&lt;/span&gt; libcudnn.so libcudnn.so.5 &lt;span class=&quot;c&quot;&gt;#删除原有动态文件&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ln &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; libcudnn.so.5.1.5 libcudnn.so.5 &lt;span class=&quot;c&quot;&gt;#生成软衔接&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ln &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; libcudnn.so.5 libcudnn.so &lt;span class=&quot;c&quot;&gt;#生成软链接&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;6配置系统环境变量&quot;&gt;（6）配置系统环境变量&lt;/h4&gt;
&lt;p&gt;在终端中输入：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;gedit ~/.bashrc &lt;span class=&quot;c&quot;&gt;#打开.bashrc文件&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;在弹出的文本编辑界面中，在文本的最后添加以下两行脚本：&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;export PATH=/usr/local/cuda-8.0/bin${PATH:+:${PATH}}
export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;保存，并使设置立即生效，在终端中输入&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; ~/.bashrc
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;重启电脑。&lt;/p&gt;

&lt;h4 id=&quot;7安装tensorflow&quot;&gt;（7）安装tensorflow&lt;/h4&gt;
&lt;p&gt;在此之前安装其他依赖包&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install python-numpy python-dev python-wheel
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;下载tensorflow-1.5.0的源码，注意千万不要下载官网的代码，因为官网已经更新至tensorflow-2.0，对应的软件环境配置也会翻天覆地的变化。因此我们选用更老的版本，如&lt;strong&gt;tensorflow-1.5.0&lt;/strong&gt;，相对更加稳定，而且很多算法也是基于这样的环境编写的。&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install git
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/theodore-zxd/tensorflow-1.5.0-rc0.git
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;运行配置文件&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;tensorflow
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./configure
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;接下来是一些列配置问题，其他任何问题都可以按回车使用默认值，但是在回答&lt;strong&gt;CUDA的那项一定要选择yes&lt;/strong&gt;，参考下面&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Please input the desired Python library path to use.  Default is [/home/shengchun/tensorflow/models/]/usr/local/lib/python3.5/dist-packages
Do you wish to build TensorFlow with jemalloc as malloc support? [Y/n]:[Enter]
jemalloc as malloc support will be enabled for TensorFlow.

Do you wish to build TensorFlow with Google Cloud Platform support? [Y/n]:[Enter]
Google Cloud Platform support will be enabled for TensorFlow.

Do you wish to build TensorFlow with Hadoop File System support? [Y/n]:[Enter]
Hadoop File System support will be enabled for TensorFlow.

Do you wish to build TensorFlow with XLA JIT support? [y/N]:[Enter]
No XLA JIT support will be enabled for TensorFlow.

Do you wish to build TensorFlow with GDR support? [y/N]:[Enter]
No GDR support will be enabled for TensorFlow.

Do you wish to build TensorFlow with VERBS support? [y/N]:[Enter]
No VERBS support will be enabled for TensorFlow.

Do you wish to build TensorFlow with OpenCL support? [y/N]:[Enter]
No OpenCL support will be enabled for TensorFlow.

Please specify the CUDA SDK version you want to use. [Leave empty to default to CUDA 10.0]: 8.0

Please specify the location where CUDA 8.0 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: [Enter]

Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN 7]: 5.1.10

Please specify the location where cuDNN 5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]: [Enter]


Do you wish to build TensorFlow with TensorRT support? [y/N]: [Enter]
No TensorRT support will be enabled for TensorFlow.

Please specify the locally installed NCCL version you want to use. [Default is to use https://github.com/nvidia/nccl]: [Enter]

Please specify a list of comma-separated CUDA compute capabilities you want to build with.
You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.
Please note that each additional compute capability significantly increases your build time and binary size, and that TensorFlow only supports compute capabilities &amp;gt;= 3.5 [Default is: 6.1]: [Enter]

Do you want to use clang as CUDA compiler? [y/N]:  [Enter]
nvcc will be used as CUDA compiler.

Please specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: [Enter]

Do you wish to build TensorFlow with MPI support? [y/N]: [Enter]
No MPI support will be enabled for TensorFlow.
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;配置完毕后开始编译，这一步耗时比较长，做好心理准备，起码一个多小时是要的：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bazel build &lt;span class=&quot;nt&quot;&gt;--config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;opt //tensorflow/tools/pip_package:build_pip_package
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./bazel-bin/tensorflow/tools/pip_package/build_pip_package ./tensorflow_pkg
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;如果上面步骤出现下面这个问题：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;ERROR: Config value cuda is not defined &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;any .rc file
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;这个就是你之前安装的bazel版本过高导致的，所以一定要选择对应的bazel-0.5.4的版本才行。解决方法就是重新安装bazel即可，安装脚本会自动覆盖之前的版本，不需要卸载。&lt;/p&gt;

&lt;p&gt;成功的话会在，在tensorflow_pkg下生成了&lt;code class=&quot;highlighter-rouge&quot;&gt;tensorflow-1.5.0rc0-cp27-cp27mu-linux_x86_64.whl&lt;/code&gt;然后进入到这个文件夹下，运行以下命令，用pip完成安装：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;pip install tensorflow-1.5.0rc0-cp27-cp27mu-linux_x86_64.whl
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;8验证tensorflow&quot;&gt;（8）验证tensorflow&lt;/h4&gt;
&lt;p&gt;提示安装成功后，在命令行输入&lt;code class=&quot;highlighter-rouge&quot;&gt;python&lt;/code&gt;，运行python终端，输入以下代码：&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;tensorflow&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tf&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;3.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;2.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;2.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;product&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matmul&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Session&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;如果能够弹出本机的显卡信息，那就恭喜你已经完成了GPU版本的tensorflow的安装了。
&lt;img src=&quot;/img/in-post/GAN/fig6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;2-安装scipy等其他科学计算拓展包&quot;&gt;2. 安装SciPy等其他科学计算拓展包&lt;/h3&gt;
&lt;p&gt;在终端输入以下命令来完成安装：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install python-numpy python-scipy python-matplotlib ipython ipython-notebook python-pandas python-sympy python-nose
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install python-opencv &lt;span class=&quot;c&quot;&gt;#安装python的opencv库&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;pip install &lt;span class=&quot;nt&quot;&gt;-U&lt;/span&gt; scikit-learn &lt;span class=&quot;c&quot;&gt;#安装机器学习python拓展包sklearn&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install python-requests &lt;span class=&quot;c&quot;&gt;#安装request用于下载数据集&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;pip install tqdm &lt;span class=&quot;c&quot;&gt;#安装tqdm用于显示进度条&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-搭建csgm和dcgan&quot;&gt;3. 搭建CSGM和DCGAN&lt;/h3&gt;
&lt;h4 id=&quot;1安装pypng和pywt&quot;&gt;（1）安装pypng和pywt&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;pip install pypng &lt;span class=&quot;c&quot;&gt;#这是python处理png图像的拓展包&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;pip install PyWavelets &lt;span class=&quot;c&quot;&gt;#这是python进行小波变换的拓展包&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;2下载源码&quot;&gt;（2）下载源码&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/AshishBora/csgm.git
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;csgm
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git submodule update &lt;span class=&quot;nt&quot;&gt;--init&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--recursive&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;3下载数据集&quot;&gt;（3）下载数据集&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./setup/download_data.sh
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;4下载已经训练好的模型&quot;&gt;（4）下载已经训练好的模型&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./setup/download_models.sh
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;5运行demo&quot;&gt;（5）运行demo&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./quick_scripts/celebA_superres.sh &lt;span class=&quot;s2&quot;&gt;&quot;./images/182659.jpg&quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;这段demo实现的功能是图像超分辨率，运行结果如下图所示：
&lt;img src=&quot;/img/in-post/GAN/fig7.png&quot; alt=&quot;&quot; /&gt;
三张图的上图是原高分辨率图像，中间则是通过对第一张图做降低分辨率获得的低分辨率图像，最后一张是算法通过深度学习网络计算获得的高分辨率图像。它实现了将模糊的人脸变清晰的功能，但是我们发现变出的脸更原来的图像大相径庭。这也是这套算法，或者说对抗生成网络GAN的通病。&lt;/p&gt;

&lt;p&gt;我们再尝试另一段demo:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./quick_scripts/celebA_inpaint.sh &lt;span class=&quot;s2&quot;&gt;&quot;./images/182659.jpg&quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;这段demo完成的是inpainting的工作，也就是将原始图像挖去一块，用GAN来进行填充，这样算法就可以在某些特定的领域完成神奇的功能：）。但是我们在下图结果中可以发现，算法的性能有待改进。
&lt;img src=&quot;/img/in-post/GAN/fig8.png&quot; alt=&quot;&quot; /&gt;
但是对于数字来说，这样的 性能已经完全足够了，终端中输入以下命令：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./quick_scripts/mnist_inpaint.sh
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;我们遮住数字的一部分，完全不影响算法识别出数字的原来的样子，这样的性能在某些工业领域完全足够能够胜任。
&lt;img src=&quot;/img/in-post/GAN/fig9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;6训练&quot;&gt;（6）训练&lt;/h4&gt;
&lt;p&gt;CSGM的训练代码是调用DCGAN，因此我们需要转向研究DCGAN模型。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;（1）下载DCGAN源代码&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;DCGAN有很多版本的代码，这里我们选择tensorflow版本的，参考链接为&lt;a href=&quot;https://github.com/carpedm20/DCGAN-tensorflow&quot;&gt;https://github.com/carpedm20/DCGAN-tensorflow&lt;/a&gt; 输入以下命令下载源码：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/carpedm20/DCGAN-tensorflow.git
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;（2）添加mnist数据集&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;在DCGAN官方链接中提示我们需要在线下载数据库，但是在国内的同学使用脚本下载数据库会出现网络问题，因为google被墙了。所幸我们在上个部分CSGM中已经下载过这个数据集，只要把他们挪过来就可以使用了（&lt;strong&gt;注意mnist挪过来的时候里面的压缩包都要解压，然后每个文件的名字都需要将中间的.改成-&lt;/strong&gt;）。
&lt;img src=&quot;/img/in-post/GAN/fig10.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/img/in-post/GAN/fig11.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/img/in-post/GAN/fig12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;（3）训练和测试&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;在DCGAN根目录下的终端中输入&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python main.py &lt;span class=&quot;nt&quot;&gt;--dataset&lt;/span&gt; mnist &lt;span class=&quot;nt&quot;&gt;--input_height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28 &lt;span class=&quot;nt&quot;&gt;--output_height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28 &lt;span class=&quot;nt&quot;&gt;--train&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;训练需要一些时间，并且显卡的动静很大。完成以后，输入以下指令完成测试：&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python main.py &lt;span class=&quot;nt&quot;&gt;--dataset&lt;/span&gt; mnist &lt;span class=&quot;nt&quot;&gt;--input_height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28 &lt;span class=&quot;nt&quot;&gt;--output_height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;测试结果的图像输出在&lt;code class=&quot;highlighter-rouge&quot;&gt;/samples&lt;/code&gt;目录下，如下图所示。而训练的网络参数保存在&lt;code class=&quot;highlighter-rouge&quot;&gt;、checkpoint&lt;/code&gt;目录下，后面大家可以自己试下用DCGAN的训练结果去替换之前CSGM的网络参数（因为CSGM就是基于DCGAN设计的），再运行下CSGM，看看自己训练的模型输出如何。
&lt;img src=&quot;/img/in-post/GAN/fig13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;p&gt;由于篇幅问题，linux下深度学习算法初步入门就讲到这里，后面读者可以在CSGM和DCGAN的基础上，深入研究这两个算法的机理。&lt;/p&gt;

&lt;p&gt;此外，完成本文环境配置过程的同学一定觉得配置算法环境很麻烦，而且如果我们想切换另一套代码，换个环境，那岂不是又要重装系统，再来一遍？非也，后面的文章我们就会一起研究解决这个问题的好方法——docker，敬请关注。&lt;/p&gt;
</description>
        <pubDate>Thu, 04 Apr 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/04/04/GAN/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/04/04/GAN/</guid>
        
        <category>GAN</category>
        
        <category>深度学习</category>
        
        <category>图像处理</category>
        
        
      </item>
    
      <item>
        <title>Hello World! </title>
        <description>&lt;hr /&gt;

&lt;blockquote&gt;
  &lt;p&gt;“来了，老弟. ”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;在这个时代，只有保持高效的学习效率才能让自己跟上社会发展的节奏，在算法研究领域更是如此。&lt;/p&gt;

&lt;p&gt;硬件传感器，互联网和高性能计算平台在21世纪获得了长足的进步，这也导致我们越来越容易接触到各种类型的数据。可以说，数据链接了所有人生活，而算法则是处理这些数据的方法，拥有高超的算法功力必定能在这个时代活出不一样的色彩。&lt;/p&gt;

&lt;p&gt;在这里我将持续与大家分享和学习各类算法，愿每一个人都可以有收获。&lt;/p&gt;
</description>
        <pubDate>Wed, 20 Mar 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/03/20/hello/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/03/20/hello/</guid>
        
        <category>生活</category>
        
        
      </item>
    
      <item>
        <title>深度学习上手</title>
        <description>&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;根据本人多年来从事算法研究的经验，学习一个或者一类算法最快速的方法就是&lt;strong&gt;实践&lt;/strong&gt;。这种“先动手后动脑”的学习模式，往往能带来高效的学习效率。本文就从搭建一种典型的深度学习网络入手，让大家快速入门机器学习算法研究领域。&lt;/p&gt;

&lt;p&gt;图像处理是机器学习算法应用最为广泛的领域之一，而&lt;strong&gt;图像去噪&lt;/strong&gt;任务是其中较为基础且重要的一种应用，如下图所示。&lt;strong&gt;卷积神经网络&lt;/strong&gt;（&lt;strong&gt;CNN&lt;/strong&gt;, 深度学习方法的一种）拥有很高的去噪性能，这里我们就搭建一种称为&lt;a href=&quot;https://github.com/cszn/DnCNN&quot;&gt;DnCNN&lt;/a&gt; [1]的去噪神经网络。读者可以借此机会体验和理解CNN，图像去噪和深度学习等方法机理。
&lt;img src=&quot;/img/in-post/dncnn/fig1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;硬件和系统要求&quot;&gt;硬件和系统要求&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;由于此网络训练和应用过程都会使用到显卡，确保自己电脑拥有块不错性能的独立显卡。另外显卡品牌只能是&lt;strong&gt;NVIDIA&lt;/strong&gt;，经过测试性能优于NVIDIA GeForce MX150的显卡即可。&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;WIN10&lt;/strong&gt;系统（本文挑选了一种可以在较为常用的windows系统下运行的网络作为入门，但是大部分深度学习算法都会选择在LINUX系统下搭建，本博客后续的文章也将会以LINUX系统中的算法为主）&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;开始搭建环境&quot;&gt;开始搭建环境&lt;/h2&gt;

&lt;p&gt;环境搭建时请注意各个软件的版本号，版本对不上的话有时会遇到难以解释的bug。配置环境对于很多算法来说是比较麻烦又不可绕过的一坎。配置过程中我们应该时刻保持警惕，弄错一个步骤就会导致功亏一篑，最后&lt;strong&gt;再次重装系统&lt;/strong&gt;，从头再来。另外需要注意的一点是：各个软件的&lt;strong&gt;安装顺序&lt;/strong&gt;也需要按照本教程按部就班的进行，否则也会出现难以解释的问题。&lt;/p&gt;

&lt;h3 id=&quot;1-安装cuda91&quot;&gt;1. 安装CUDA9.1&lt;/h3&gt;

&lt;p&gt;CUDA是NVIDIA公司开发的显卡驱动工具包，凡是使用GPU并行加速的程序都依赖这个驱动，深度学习也不例外。安装包下载链接：https://developer.nvidia.com/cuda-91-download-archive?target_os=Windows&amp;amp;target_arch=x86_64&lt;/p&gt;

&lt;p&gt;参考图中的选项，再点击下载安装包，然后安装。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;安装过程中会出现CUDA提示没有预先安装Visual Studio，可以不去理会。&lt;/p&gt;

&lt;h3 id=&quot;2-安装cudnn&quot;&gt;2. 安装cuDNN&lt;/h3&gt;

&lt;p&gt;cuDNN是用于深度神经网络的GPU加速库，它可以被看做是一个依附于CUDA上的一个额外的库。一般来说，这两者结合才能满足深度学习网络的驱动需求。下载链接：https://developer.nvidia.com/rdp/cudnn-archive，注意要选择与CUDA配对的版本，如下图所示。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;cuDNN的安装是以打补丁的方式，主要是3步：&lt;/p&gt;

&lt;p&gt;（1）复制CUDA安装目录下&lt;installpath&gt;\cuda\bin\cudnn64_7.dll 文件至 C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.0\bin文件夹下&lt;/installpath&gt;&lt;/p&gt;

&lt;p&gt;（2）复制CUDA安装目录下&lt;installpath&gt;\cuda\ include\cudnn.h 文件至 C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.0\include文件夹下&lt;/installpath&gt;&lt;/p&gt;

&lt;p&gt;（3）复制CUDA安装目录下&lt;installpath&gt;\cuda\lib\x64\cudnn.lib文件至C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.0\lib\x64文件夹下&lt;/installpath&gt;&lt;/p&gt;

&lt;p&gt;（4）复制完成后，原先完整的cuDNN安装包存下来不要删除，后面步骤还需要使用。&lt;/p&gt;

&lt;h3 id=&quot;3-安装visual-studio-2015&quot;&gt;3. 安装VISUAL STUDIO 2015&lt;/h3&gt;

&lt;p&gt;VS就不用介绍了，可以说是windows下宇宙第一编译器。这里我们使用2015版，community版本就可以了，无需破解。&lt;/p&gt;

&lt;p&gt;下载地址：https://visualstudio.microsoft.com/zh-hans/vs/older-downloads/?rr=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D2bJ7RUd1X4L6JArIAU13JVQE-FnrHi5jiu-uzEPUCljNXw5rp37OH-HtIzKoBs5AJ-mOSQRLfz9rOxjWx_Soha%26wd%3D%26eqid%3Da5636d210001544a000000045c923f05&lt;/p&gt;

&lt;p&gt;安装完VS还需要安装配套的C++编译器。打开刚才安装的VS2015，新建项目，安装适用于windows桌面的C++工具，如下图所示。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;4-安装matlab-2017a&quot;&gt;4. 安装MATLAB 2017a&lt;/h3&gt;

&lt;p&gt;注意MATLAB的版本号哦，2016版的我也曾经试过，可行，但是其他版本就不敢保证了。最好是按照本教程选择2017a的MATLAB。由于这一步的安装涉及到破解，因此下载链接可能随时会失效。这里就请读者自行查找靠谱的下载链接了，并且自己破解了。&lt;/p&gt;

&lt;h3 id=&quot;5-matconvnet安装&quot;&gt;5. MatConvNet安装&lt;/h3&gt;

&lt;p&gt;敲黑板！注意这里是环境搭建的最重要的一步，也是比较复杂的一步，务必打起精神。&lt;/p&gt;

&lt;p&gt;MatConvNet是MATLAB的一个官方定制的工具盒，用来处理卷积神经网络的搭建和使用。它的官方网址是：http://www.vlfeat.org/matconvnet/，上面找到下载链接（版本号：matconvnet-1.0-beta25），下载压缩包。具体安装步骤如下：&lt;/p&gt;

&lt;p&gt;（1）&lt;strong&gt;解压&lt;/strong&gt;：将压缩包中的MatConvNet解压到某个目录下（解压在C盘的某些文件夹下会有权限问题，建议解压在其他盘，或者桌面上，教程上我们就示范解压在桌面上）。将MATLAB的工作路径置于所解压的文件夹下的matlab文件夹中，如下图。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;（2）&lt;strong&gt;设置&lt;/strong&gt;：由于MatConNet有部分涉及C++语言编写的代码，因此需要配置MATLAB兼容C++的交叉编译，输入以下命令：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;gt; mex -setup C++
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;p&gt;运行结果如下图所示。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;（3）&lt;strong&gt;复制&lt;/strong&gt;：之前提到的存下来的cuDNN完整安装包，这里要派上用处啦，因为MatConvNet的安装需要依赖cuDNN。将整个cuDNN文件夹放置在MATLAB安装目录下，如下图。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;（4）&lt;strong&gt;编译&lt;/strong&gt;：最后输入以下命令完成MatConvNet的编译。&lt;/p&gt;

&lt;div class=&quot;language-matlab highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vl_compilenn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'enableGpu'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;...&lt;/span&gt;
               &lt;span class=&quot;s1&quot;&gt;'cudaRoot'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;...&lt;/span&gt;
               &lt;span class=&quot;s1&quot;&gt;'cudaMethod'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'nvcc'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;...&lt;/span&gt;
               &lt;span class=&quot;s1&quot;&gt;'enableCudnn'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;...&lt;/span&gt;
               &lt;span class=&quot;s1&quot;&gt;'cudnnRoot'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'C:\Program Files\MATLAB\cudnn'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面cudaRoot是安装的CUDA的文件目录，cudnnRoot是上一步复制的文件目录，可以根据自己安装情况进行修改。然后出现以下提示就是成功完成安装了。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;注意：之后每次打开MATLAB都需要进入…/matconvnet/matlab的目录下，运行上述编译代码，然后才能使用整个CNN工具箱进行深度学习研究。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;（5）&lt;strong&gt;验证&lt;/strong&gt;：在MATLAB命令行输入以下命令，测试之前几部的安装是否正确，这时你可以听听显卡呻吟的声音:&lt;/p&gt;

&lt;div class=&quot;language-matlab highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vl_testnn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'gpu'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;测试时间比较久，耐性等待之后，大家就可以开始深度学习之旅了！兴奋地搓着小手.gif&lt;/p&gt;

&lt;h2 id=&quot;6-运行dncnn&quot;&gt;6. 运行DnCNN&lt;/h2&gt;

&lt;p&gt;首先从github上下载源码https://github.com/cszn/DnCNN，解压。将MATLAB的工作目录设为../DnCNN-master/TrainingCodes/DnCNN_TrainingCodes_DagNN_v1.1，然后运行测试脚本Demo_Test_DnCNN_DAG.m,接下来大家就能看到网络对12张测试图片的去澡效果啦。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/dncnn/fig9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;左图为加噪声图像，中间为原始图像，右图为去噪后图像，可以看到CNN还是比较给力的，这样的去噪效果传统方法是达不到的。&lt;/p&gt;

&lt;p&gt;了解深度学习的朋友都知道，重要的还是训练过程，那么这个网络怎么训练它呢？&lt;/p&gt;

&lt;p&gt;（1）我们将MATLAB工作目录至于…/DnCNN-master/TrainingCodes/DnCNN_TrainingCodes_v1.0/data，运行GenerateData_model_64_25_Res_Bnorm_Adam.m脚本以生成批量训练的数据对。这个脚本是将当前目录下Train400文件夹下的图像进行分批，加噪声的方式组成无噪声和有噪声的两种图像数据对，用来后续训练神经网络。&lt;/p&gt;

&lt;p&gt;（2）完成以后，进入上一级目录，运行Demo_Train_model_64_25_Res_Bnorm_Adam.m脚本，这时候就开始训练神经网络了。这里需要注意，有些显卡显存不够的话，训练一段时间会报错，显示“显存不够”。这时候就需要一些高端操作来解决这个问题了，比如更改神经网络的层数等等。考虑到本文篇幅问题，这些操作就不在这边细说了。测试下来GTX 1070以上的显卡还是能够胜任这个工作的。训练时间不长也不短，几个小时还是要的。&lt;/p&gt;

&lt;p&gt;（3）完成训练以后，在运行当前目录下的Demo_Test_model_64_25_Res_Bnorm_Adam.m脚本就能获得对新训练模型的测试结果了。&lt;/p&gt;

&lt;p&gt;测试过程中我们可以发现，还有很多脚本，有的却不能运行。其中的原因交给读者慢慢寻找原因啦，找原因的过程也是一个高效学习的过程。&lt;/p&gt;

&lt;h2 id=&quot;7-总结&quot;&gt;7. 总结&lt;/h2&gt;

&lt;p&gt;以上便是，在windows下搭建DnCNN的全部详细流程。希望借此机会能够让读者入门深度学习，感受到算法的魅力。之后本博客还会更新其他一些算法的搭建流程，后续还会讲解算法原理，敬请期待。&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;参考文献：
[1] Zhang K , Zuo W , Chen Y , et al. Beyond a Gaussian Denoiser: Residual Learning of Deep CNN for Image Denoising[J]. IEEE TRANSACTIONS ON IMAGE PROCESSING.&lt;/p&gt;
</description>
        <pubDate>Wed, 20 Mar 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/03/20/dncnn_matlab/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/03/20/dncnn_matlab/</guid>
        
        <category>CNN</category>
        
        <category>深度学习</category>
        
        <category>图像处理</category>
        
        
      </item>
    
  </channel>
</rss>
